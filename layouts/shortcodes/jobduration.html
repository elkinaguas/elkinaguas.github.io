{{/* jobduration shortcode: calculates duration between two dates with pluralization and i18n */}}

{{ $start := time (.Get "start") }}
{{ $endParam := lower (.Get "end") }}
{{ $end := time "1970-01-01" }} {{/* dummy init */}}

{{ if or (eq $endParam "actuel") (eq $endParam "current") (eq $endParam "actual") }}
  {{ $end = now }}
{{ else }}
  {{ $end = time $endParam }}
{{ end }}

{{ $years := sub ($end.Year) ($start.Year) }}
{{ $months := sub ($end.Month) ($start.Month) }}

{{ if lt $months 0 }}
  {{ $years = sub $years 1 }}
  {{ $months = add $months 12 }}
{{ end }}

{{ $monthsList := slice
  "january" "february" "march" "april" "may" "june"
  "july" "august" "september" "october" "november" "december"
}}

{{ $startMonthKey := index $monthsList (sub $start.Month 1) }}
{{ $endMonthKey := index $monthsList (sub $end.Month 1) }}

{{ $startMonthName := T $startMonthKey }}
{{ $endMonthName := T $endMonthKey }}
{{ $duration := "" }}

{{ if ge $end.Unix $start.Unix }}
  {{ if gt $years 0 }}
    {{ $duration = print $years " " (cond (eq $years 1) (T "year_singular") (T "year_plural")) }}
    {{ if gt $months 0 }}
      {{ $duration = print $duration " " (T "and") " " $months " " (cond (eq $months 1) (T "month_singular") (T "month_plural")) }}
    {{ end }}
  {{ else if gt $months 0 }}
    {{ $duration = print $months " " (cond (eq $months 1) (T "month_singular") (T "month_plural")) }}
  {{ else }}
    {{ $duration = T "less_than_a_month" }}
  {{ end }}
{{ end }}

<span style="color: #999; font-size: 0.9rem;">
  {{ $startMonthName }} {{ $start.Year }} â€“
  {{ if or (eq $endParam "actuel") (eq $endParam "current") (eq $endParam "actual") }}
    {{ T "current" }}
  {{ else }}
    {{ $endMonthName }} {{ $end.Year }}
  {{ end }}

  {{ if ne $duration "" }}
    ({{ $duration }})
  {{ end }}
</span>
